diff --git a/cmake/modules/FindRpm.cmake b/cmake/modules/FindRpm.cmake
index 29696e3..75085c2 100644
--- a/cmake/modules/FindRpm.cmake
+++ b/cmake/modules/FindRpm.cmake
@@ -5,11 +5,13 @@ if(RPM_INCLUDE_DIR AND RPM_LIBRARY)
 endif(RPM_INCLUDE_DIR AND RPM_LIBRARY)
 
 set(RPM_LIBRARY)
+set(RPMIO_LIBRARY)
 set(RPM_INCLUDE_DIR)
 
 FIND_PATH(RPM_INCLUDE_DIR rpm/rpmdb.h
 	/usr/include
 	/usr/local/include
+	/opt/profbuild/include
 )
 
 set(RPM_SUSPECT_VERSION "RPM_SUSPECT_VERSION-NOTFOUND" )
@@ -38,7 +40,9 @@ FIND_LIBRARY(RPM_LIBRARY NAMES rpm
 	PATHS
 	/usr/lib
 	/usr/local/lib
+	/opt/profbuild/lib
 )
+FIND_LIBRARY(RPMIO_LIBRARY NAMES rpmio PATHS /opt/profbuild/lib)
 
 if(RPM_INCLUDE_DIR AND RPM_LIBRARY)
    MESSAGE( STATUS "rpm found: includes in ${RPM_INCLUDE_DIR}, library in ${RPM_LIBRARY} (suspect ${RPM_SUSPECT_VERSION})")
@@ -47,4 +51,4 @@ else(RPM_INCLUDE_DIR AND RPM_LIBRARY)
    MESSAGE( STATUS "rpm not found")
 endif(RPM_INCLUDE_DIR AND RPM_LIBRARY)
 
-MARK_AS_ADVANCED(RPM_INCLUDE_DIR RPM_LIBRARY)
\ No newline at end of file
+MARK_AS_ADVANCED(RPM_INCLUDE_DIR RPM_LIBRARY RPMIO_LIBRARY)
diff --git a/cmake/modules/FindSatsolver.cmake b/cmake/modules/FindSatsolver.cmake
index 1c462bf..48c6fb3 100644
--- a/cmake/modules/FindSatsolver.cmake
+++ b/cmake/modules/FindSatsolver.cmake
@@ -19,6 +19,7 @@ FIND_LIBRARY(SATSOLVER_LIBRARY NAMES satsolver
 	${CMAKE_INSTALL_PREFIX}/lib
 	/usr/local/lib
 	/usr/lib
+	/opt/profbuild/lib64
 )
 
 FIND_LIBRARY(SATSOLVER_EXT_LIBRARY NAMES satsolverext
@@ -26,6 +27,7 @@ FIND_LIBRARY(SATSOLVER_EXT_LIBRARY NAMES satsolverext
 	${CMAKE_INSTALL_PREFIX}/lib
 	/usr/local/lib
 	/usr/lib
+	/opt/profbuild/lib64
 )
 
 if(SATSOLVER_INCLUDE_DIR AND SATSOLVER_LIBRARY)
diff --git a/zypp/CMakeLists.txt b/zypp/CMakeLists.txt
index 7a0aebc..fa86227 100644
--- a/zypp/CMakeLists.txt
+++ b/zypp/CMakeLists.txt
@@ -899,7 +899,7 @@ SET_LOGGROUP( "satsolver" ${zypp_sat_SRCS} )
 #SET_LOGGROUP( "group" ${zypp_pool_SRCS} )
 
 
-ADD_LIBRARY(zypp SHARED ${zypp_lib_SRCS})
+ADD_LIBRARY(zypp STATIC ${zypp_lib_SRCS})
 SET_TARGET_PROPERTIES( zypp PROPERTIES VERSION "${LIBZYPP_VERSION_INFO}" )
 SET_TARGET_PROPERTIES( zypp PROPERTIES SOVERSION "${LIBZYPP_SOVERSION_INFO}" )
 SET_TARGET_PROPERTIES( zypp PROPERTIES LINK_FLAGS "--as-needed" )
@@ -909,7 +909,7 @@ SET(UTIL_LIBRARY util)
 #SET(SIGNALS_LIBRARY boost_signals)
 SET(SIGNALS_LIBRARY boost_signals-mt)
 TARGET_LINK_LIBRARIES(zypp ${UTIL_LIBRARY} )
-TARGET_LINK_LIBRARIES(zypp ${RPM_LIBRARY} )
+TARGET_LINK_LIBRARIES(zypp ${RPM_LIBRARY} ${RPMIO_LIBRARY} ${SATSOLVER_LIBRARY} ${SATSOLVER_EXT_LIBRARY} lzma popt pthread nss3 bz2 dl elf)
 TARGET_LINK_LIBRARIES(zypp ${GETTEXT_LIBRARIES} )
 TARGET_LINK_LIBRARIES(zypp ${CURL_LIBRARY} )
 TARGET_LINK_LIBRARIES(zypp ${LIBXML_LIBRARY} )
@@ -921,7 +921,7 @@ TARGET_LINK_LIBRARIES(zypp ${SIGNALS_LIBRARY} )
 TARGET_LINK_LIBRARIES(zypp ${UDEV_LIBRARY} )
 TARGET_LINK_LIBRARIES(zypp ${LIBPROXY_LIBRARIES} )
 
-INSTALL(TARGETS zypp LIBRARY DESTINATION ${LIB_INSTALL_DIR} )
+INSTALL(TARGETS zypp DESTINATION ${LIB_INSTALL_DIR} )
 
 # install XML schemas
 FILE( GLOB YUM_SCHEMA_FILES ${LIBZYPP_SOURCE_DIR}/zypp/parser/yum/schema/*.rng )
diff --git a/zypp/target/rpm/RpmDb.cc b/zypp/target/rpm/RpmDb.cc
index a76ddac..82eacb9 100644
--- a/zypp/target/rpm/RpmDb.cc
+++ b/zypp/target/rpm/RpmDb.cc
@@ -1444,7 +1444,9 @@ RpmDb::run_rpm (const RpmArgVec& opts,
   RpmArgVec args;
 
   // always set root and dbpath
-  args.push_back("rpm");
+  args.push_back("prof-rpm");
+  args.push_back("--nochroot");
+  args.push_back("--noscripts");
   args.push_back("--root");
   args.push_back(_root.asString().c_str());
   args.push_back("--dbpath");
diff --git a/zypp/target/rpm/librpmDb.cc b/zypp/target/rpm/librpmDb.cc
index 1689fbb..36d6b05 100644
--- a/zypp/target/rpm/librpmDb.cc
+++ b/zypp/target/rpm/librpmDb.cc
@@ -17,6 +17,7 @@
 #include "zypp/target/rpm/librpmDb.h"
 #include "zypp/target/rpm/RpmHeader.h"
 #include "zypp/target/rpm/RpmException.h"
+#include "lib/rpmdb_internal.h"
 
 using namespace std;
 
diff --git a/zypp/target/rpm/librpmDb.cv3.cc b/zypp/target/rpm/librpmDb.cv3.cc
index bf18e45..550de04 100644
--- a/zypp/target/rpm/librpmDb.cv3.cc
+++ b/zypp/target/rpm/librpmDb.cv3.cc
@@ -38,6 +38,7 @@ typedef int32_t rpm_count_t;
 #include "zypp/target/rpm/librpmDb.h"
 #include "zypp/target/rpm/RpmCallbacks.h"
 #include "zypp/ZYppCallbacks.h"
+#include "lib/rpmdb_internal.h"
 
 extern "C"
 {
@@ -509,7 +510,7 @@ void internal_convertV3toV4( const Pathname & v3db_r, const librpmDb::constPtr &
 #ifdef _RPM_5
     if (rpmdbAdd(db, -1, h, 0))
 #else
-    if (rpmdbAdd(db, -1, h, 0, 0))
+    if (rpmdbAdd(db, h))
 #endif
     {
 //      report.dbWriteError( nrv );
